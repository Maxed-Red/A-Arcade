<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A+ Arcade — Compat Build</title>
<style>
  :root {
    --bg: #0f1220;
    --panel: #171a2b;
    --panel-2: #1e2240;
    --text: #e7e9f5;
    --muted: #a9add4;
    --accent: #8ab4ff;
    --accent-2: #7df9c9;
    --danger: #ff6b6b;
    --warn: #ffd166;
    --ok: #06d6a0;
  }
  * { box-sizing:border-box; }
  body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial; background:linear-gradient(180deg, #0d1020, #171a2b 45%, #0d1020); color:var(--text); }
  header { position:sticky; top:0; z-index:10; background:rgba(15,18,32,.9); backdrop-filter: blur(8px); border-bottom:1px solid #2a2f58; }
  .wrap { max-width:1100px; margin:0 auto; padding:16px; }
  h1 { margin:0; font-size:24px; letter-spacing:.4px; }
  .subtitle { color:var(--muted); font-size:13px; margin-top:6px; }
  .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; }
  .card { background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid #2a2f58; border-radius:16px; padding:14px; box-shadow: 0 6px 24px rgba(0,0,0,.25); }
  .card h3 { margin:4px 0 8px; font-size:16px; }
  .btn { display:inline-flex; align-items:center; gap:8px; background:linear-gradient(180deg,#263067,#1e264d); border:1px solid #33408c; padding:10px 14px; border-radius:12px; color:var(--text); text-decoration:none; cursor:pointer; font-weight:600; transition:.15s transform ease; }
  .btn:hover { transform: translateY(-1px); }
  .btn.secondary { background:#1a1d33; border-color:#2a2f58; color:#c9cdf5 }
  .btn.ghost { background:transparent; border-color:#2a2f58; color:#b9bdf0 }
  .controls { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
  .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid #2a2f58; color:#bfc3f7; background:#151936; }
  .switch { position:relative; display:inline-block; width:46px; height:26px; vertical-align:middle; }
  .switch input { opacity:0; width:0; height:0; }
  .slider { position:absolute; cursor:pointer; inset:0; background:#28305f; border-radius:999px; border:1px solid #2a2f58; transition:.2s; }
  .slider:before { position:absolute; content:""; height:20px; width:20px; left:3px; top:2px; background:#0f152f; border:1px solid #2a2f58; border-radius:50%; transition:.2s; }
  input:checked + .slider { background:#204d3a; border-color:#2b8f71; }
  input:checked + .slider:before { transform:translateX(20px); }
  .kpi { display:flex; gap:10px; align-items:center; font-size:14px; color:#c7ccff }
  .row { display:flex; gap:12px; align-items:center; }
  .row.wrap { flex-wrap:wrap }
  .spacer { flex:1; }
  .muted { color:var(--muted) }
  .inset { padding:12px; border-radius:12px; background:#10142c; border:1px solid #222959; }
  .question { font-size:16px; line-height:1.45; }
  .choices { display:grid; gap:8px; margin-top:12px; }
  .choice { padding:10px 12px; border-radius:12px; border:1px solid #2a2f58; cursor:pointer; background:#121735; }
  .choice.correct { border-color:#1fbf8f; box-shadow:inset 0 0 0 1px #1fbf8f; }
  .choice.wrong { border-color:#d34b4b; box-shadow:inset 0 0 0 1px #d34b4b; }
  .answer { margin-top:10px; font-size:14px; color:#fff; } /* brighter */
  .verdict { margin-top:10px; padding:10px 12px; border-radius:12px; border:1px solid #2a2f58; background:#101a33; font-weight:700; }
  .verdict.ok { border-color:#1fbf8f; background:#0f1f20; }
  .verdict.bad { border-color:#d34b4b; background:#2a1420; }
  /* Dropdown readability */
  select.btn, select.btn option { color:#000 !important; }
  select.btn { background:#fff !important; border-color:#c7cbe6; }
  select.btn option:checked, select.btn option:hover { color:#000; background:#cfe0ff; }
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row wrap">
        <div>
          <h1>A+ Arcade</h1>
          <div class="subtitle">Compat build (no modern JS syntax) for older browsers & GH Pages.</div>
        </div>
        <div class="spacer"></div>
        <div class="kpi"><span>LVL <span id="lvl">1</span></span> · <span class="xp"><span id="xp">0</span> XP</span> · <span>Streak <span id="streak">0</span></span></div>
      </div>
      <div class="wrap" style="padding-top:8px;">
        <div class="controls">
          <button class="btn" onclick="gotoMode('learn')">Learn (SRS)</button>
          <button class="btn secondary" onclick="gotoMode('quiz')">Quiz</button>
          <button class="btn ghost" onclick="gotoMode('exam')">Exam Sim</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap" id="app" style="padding-bottom:64px;">
    <section id="learn">
      <div class="row wrap">
        <div class="pill">Spaced Repetition</div>
        <div class="spacer"></div>
        <label class="row" style="gap:8px;">
          <span class="small muted">Teach Mode</span>
          <label class="switch">
            <input id="teachToggle" type="checkbox"><span class="slider"></span>
          </label>
        </label>
        <select id="learnDomain" class="btn ghost"></select>
        <button class="btn" onclick="startLearn()">Load</button>
      </div>
      <div id="learnArea" class="card" style="margin-top:12px;">
        <div class="center muted">Pick a domain, toggle <strong>Teach</strong> if you want, then press <strong>Load</strong>.</div>
      </div>
    </section>

    <section id="quiz" class="hidden">
      <div class="row wrap">
        <div class="pill">Arcade Quiz</div>
        <div class="spacer"></div>
        <select id="quizDomain" class="btn ghost"></select>
        <select id="quizCount" class="btn ghost">
          <option value="10">10 Qs</option><option value="20">20 Qs</option><option value="30">30 Qs</option>
        </select>
        <button class="btn" onclick="startQuiz()">Play</button>
      </div>
      <div id="quizArea" class="card" style="margin-top:12px;">
        <div class="center muted">Choose domain & count, then press <strong>Play</strong>.</div>
      </div>
    </section>

    <section id="exam" class="hidden">
      <div class="row wrap">
        <div class="pill">Exam Simulator</div>
        <div class="spacer"></div>
        <button class="btn" onclick="startExam()">Start</button>
      </div>
      <div id="examArea" class="card" style="margin-top:12px;">
        <div class="center muted">90 minutes · up to 90 questions.</div>
      </div>
    </section>
  </main>

<script>
/* ==== Safe storage shim (works even if localStorage is blocked) ==== */
var storageOK = true;
try { var _t = '__t'; window.localStorage.setItem(_t,'1'); window.localStorage.removeItem(_t); } catch (e) { storageOK = false; }
var SafeStore = {
  get: function(k){ if(!storageOK) return null; try{ return window.localStorage.getItem(k); }catch(e){ return null; } },
  set: function(k,v){ if(!storageOK) return; try{ window.localStorage.setItem(k,v); }catch(e){} }
};

/* ==== Utils ==== */
function $(q){ return document.querySelector(q); }
function $all(q){ return Array.prototype.slice.call(document.querySelectorAll(q)); }
function shuffle(arr){ return arr.map(function(v){ return [Math.random(),v]; }).sort(function(a,b){ return a[0]-b[0]; }).map(function(x){ return x[1]; }); }
function uid(){ return Math.random().toString(36).slice(2,9); }

/* ==== State ==== */
var SAVE_KEY='aplus_arcade_v120x';
var defaultState={xp:0,level:1,streak:0,bossWins:0,seen:{},correct:{},srs:{},settings:{teach:false},ach:{}};
var state;
try { state = JSON.parse(SafeStore.get(SAVE_KEY) || 'null') || defaultState; } catch(e){ state = defaultState; }
function save(){ SafeStore.set(SAVE_KEY, JSON.stringify(state)); updateHeader(); }
function updateHeader(){ $('#lvl').textContent=state.level; $('#xp').textContent=state.xp; $('#streak').textContent=state.streak; }
function addXP(n){ state.xp=Math.max(0, state.xp+n); var lvl=Math.floor(state.xp/200)+1; state.level=lvl; save(); }
function incStreak(){ state.streak++; save(); }
function resetStreak(){ state.streak=0; save(); }

/* ==== Content ==== */
var ITEMS=[], MATCH_SETS=[];
function addMC(core,domain,prompt,choices,answerIndex,explain,tags){ ITEMS.push({id:uid(),core:core,domain:domain,type:'mc',prompt:prompt,choices:choices,answer:[answerIndex],explain:explain,tags:tags||[]}); }
function addMulti(core,domain,prompt,choices,answerIndexes,explain,tags){ ITEMS.push({id:uid(),core:core,domain:domain,type:'multi',prompt:prompt,choices:choices,answer:answerIndexes,explain:explain,tags:tags||[]}); }
function addType(core,domain,prompt,answers,explain,tags){ ITEMS.push({id:uid(),core:core,domain:domain,type:'type',prompt:prompt,answer:answers.map(function(s){return String(s).toLowerCase();}),explain:explain,tags:tags||[]}); }

addMC('1201','Networking','Which protocol and port are used for secure web traffic?',['HTTP on 80','HTTPS on 443','TLS on 995','SSH on 22'],1,'HTTPS typically uses TCP 443.',['ports']);
addType('1202','Security','Write the secure alternative to Telnet.',['ssh'],'SSH replaces Telnet for encrypted remote terminal sessions.',['ports']);
addMC('1201','Networking','802.11ac operates primarily in which band?',['2.4 GHz','5 GHz','900 MHz','Both 2.4 and 5 GHz'],1,'802.11ac is 5 GHz only.',['wifi']);
addMC('1201','Hardware','Which printer uses an imaging drum and fuser?',['Laser','Inkjet','Thermal','Impact'],0,'Laser printers use toner, drum, transfer, and fuser.', ['printer']);
addMulti('1201','Hardware','Select all display outputs.',['HDMI','DisplayPort','RJ-45','DVI-D'],[0,1,3],'RJ-45 is networking.');

/* ==== Learn (SM-2) ==== */
function sm2(item, quality){
  if(!state.srs[item.id]) state.srs[item.id]={ef:2.5,rep:0,ivl:0,due:Date.now()};
  var ef=state.srs[item.id].ef, rep=state.srs[item.id].rep, ivl=state.srs[item.id].ivl;
  if(quality<3){ rep=0; ivl=1; } else { if(rep===0) ivl=1; else if(rep===1) ivl=6; else ivl=Math.max(1, Math.round(ivl*ef)); rep+=1; ef=ef+(0.1-(5-quality)*(0.08+(5-quality)*0.02)); if(ef<1.3) ef=1.3; }
  var next = Date.now() + ivl*24*60*60*1000 * (0.1+Math.random()*0.15);
  state.srs[item.id]={ef:ef,rep:rep,ivl:ivl,due:next}; save();
}

var learnQueue=[];
function startLearn(){
  state.settings.teach = !!$('#teachToggle').checked; save();
  var filter = ($('#learnDomain').value||'all');
  var now = Date.now();
  var pool = ITEMS.filter(function(i){ return filter==='all' || (i.core+' · '+i.domain)===filter; });
  if(!pool.length) pool = ITEMS.slice();
  var due = pool.filter(function(i){ return ((state.srs[i.id] && state.srs[i.id].due) || 0) <= now; });
  if(!due.length) due = pool.slice();
  learnQueue = shuffle(due).slice(0,30);
  if(!learnQueue.length){ $('#learnArea').innerHTML='<div class="center muted">No content. Import a pack.</div>'; return; }
  if(state.settings.teach) nextTeachCard(); else nextLearnCard();
}
function nextLearnCard(){
  var item = learnQueue.shift();
  if(!item){ $('#learnArea').innerHTML='<div class="center">Done!</div>'; return; }
  renderItem('#learnArea', item, function(ok,quality){ try{ sm2(item, quality|| (ok?5:2)); }catch(e){}; state.seen[item.id]=(state.seen[item.id]||0)+1; if(ok) state.correct[item.id]=(state.correct[item.id]||0)+1; save(); nextLearnCard(); }, false, {mode:'learn'});
}
function nextTeachCard(){
  var item = learnQueue.shift();
  if(!item){ $('#learnArea').innerHTML='<div class="center">Done!</div>'; return; }
  renderTeachCard('#learnArea', item, function(q){ try{ sm2(item, q||4);}catch(e){}; state.seen[item.id]=(state.seen[item.id]||0)+1; save(); nextTeachCard(); });
}
function renderTeachCard(sel, item, onDone){
  var host=$(sel); host.innerHTML='';
  var card=document.createElement('div'); card.className='inset';
  var ansText='';
  if(item.type==='mc' || item.type==='multi'){
    var idxs = Array.isArray(item.answer) ? item.answer.map(function(n){return Number(n);}) : [];
    ansText = idxs.map(function(i){ return String.fromCharCode(65+i)+'. '+((item.choices && item.choices[i]) || ''); }).join(' · ');
  } else if(item.type==='type'){ ansText=(item.answer||[]).join(', '); }
  card.innerHTML = "<div class='row small muted'><span class='pill'>"+(item.core||'')+"</span><span class='pill'>"+(item.domain||'')+
    "</span><span class='spacer'></span><span class='pill'>Teach</span></div>"+
    "<div class='question' style='margin-top:6px;'><strong>"+(item.prompt||'')+"</strong></div>"+
    "<div class='answer' style='margin-top:10px;'>"+
    (ansText? "<div class='small muted'>Correct answer(s): <strong>"+ansText+"</strong></div>": "")+
    (item.explain? "<div style='margin-top:6px;'>"+item.explain+"</div>": "")+
    "<div style='margin-top:8px;'><strong>Why it matters:</strong> "+whyFor(item)+"</div></div>"+
    "<div class='controls' style='margin-top:12px;'><button class='btn' id='teachGot'>Got it</button><button class='btn secondary' id='teachReview'>Need review</button></div>";
  host.appendChild(card);
  $('#teachGot').onclick=function(){ onDone && onDone(4); };
  $('#teachReview').onclick=function(){ onDone && onDone(2); };
}

/* ==== Render Item ==== */
function whyFor(item){
  var WHY_BY_DOMAIN={'Networking':'Example: choosing the wrong port can block apps.','Hardware':'Example: underpowered PSU causes reboots.','Operating Systems':'Example: restart a stuck service without reboot.','Security':'Example: weak Wi-Fi lets attackers in.'};
  var WHY_BY_TAG={ports:'Example: wrong firewall port leaves service unreachable.',wifi:'Example: 1/6/11 reduce interference.'};
  if(item.why) return item.why;
  if(item.tags){ for(var i=0;i<item.tags.length;i++){ var t=item.tags[i]; if(WHY_BY_TAG[t]) return WHY_BY_TAG[t]; } }
  return WHY_BY_DOMAIN[item.domain]||'Prevents outages and speeds troubleshooting.';
}

function renderItem(sel, item, onDone, compact, opts){
  var host=$(sel); if(!host) return; host.innerHTML='';
  opts = opts||{}; compact=!!compact;

  function ansIndexes(){
    if(item.type==='mc' || item.type==='multi'){
      if(Array.isArray(item.answer)) return item.answer.map(function(n){return Number(n);});
      if(typeof item.answer==='number') return [item.answer];
      return [0];
    }
    return [];
  }
  function ansText(){
    if(item.type==='mc' || item.type==='multi'){
      var idxs = ansIndexes();
      return idxs.map(function(i){ return String.fromCharCode(65+i)+'. '+((item.choices && item.choices[i]) || ''); }).join(' · ');
    }
    if(item.type==='type'){ return (item.answer||[]).join(', '); }
    return '';
  }

  var card=document.createElement('div'); card.className='inset';
  var meta = "<div class='row small muted'><span class='pill'>"+(item.core||'')+"</span><span class='pill'>"+(item.domain||'')+"</span><span class='spacer'></span><span class='pill'>"+(item.type||'mc').toUpperCase()+"</span></div>";
  var q=document.createElement('div'); q.className='question'; q.innerHTML = meta + "<div style='margin-top:6px;'>"+(item.prompt||'')+"</div>"; card.appendChild(q);
  var answerDiv=document.createElement('div'); answerDiv.className='answer hidden'; var advanced=false;

  function showReview(correct, userValue){
    userValue = userValue||'';
    var whyHTML = (opts.mode==='learn')? "<div style='margin-top:8px;'><strong>Why it matters:</strong> "+whyFor(item)+"</div>" : "";
    var explHTML = (opts.mode==='learn' && item.explain)? "<div class='small' style='margin-top:6px;'>"+item.explain+"</div>" : "";
    var corrHTML = "<div class='small muted' style='margin-top:6px;'>Correct answer(s): <strong>"+ansText()+"</strong></div>";
    var youHTML = (item.type==='type' && userValue)? "<div class='small muted'>Your answer: <em>"+userValue+"</em></div>" : "";
    answerDiv.innerHTML = "<div class='verdict "+(correct?'ok':'bad')+"'>"+(correct?'✅ Correct!':'❌ Incorrect')+"</div>"+youHTML+corrHTML+explHTML+whyHTML;
    answerDiv.classList.remove('hidden'); card.appendChild(answerDiv);
    if(opts.mode==='learn'){
      var nextBtn=document.createElement('button'); nextBtn.className='btn'; nextBtn.textContent='Next'; nextBtn.style.marginTop='10px';
      nextBtn.onclick=function(){ if(advanced) return; advanced=true; try{ onDone && onDone(correct, correct?5:2); }catch(e){} };
      answerDiv.appendChild(nextBtn);
    } else {
      setTimeout(function(){ if(advanced) return; advanced=true; try{ onDone && onDone(correct, correct?5:2); }catch(e){}; }, 1000);
    }
  }

  if(item.type==='type'){
    var inp=document.createElement('input'); inp.type='text'; inp.placeholder='Type your answer'; inp.style.width='100%'; inp.style.padding='10px'; inp.style.borderRadius='10px'; inp.style.border='1px solid #2a2f58'; inp.style.background='#0f152f'; inp.style.color='white';
    var submit=document.createElement('button'); submit.className='btn'; submit.textContent='Check'; submit.style.marginTop='10px';
    submit.onclick=function(){ state.seen[item.id]=(state.seen[item.id]||0)+1; var v=(inp.value||'').trim().toLowerCase(); var ok=(item.answer||[]).some(function(a){ return String(a).toLowerCase()===v; }); inp.style.borderColor=ok?'#1fbf8f':'#d34b4b'; showReview(ok,v); };
    card.appendChild(inp); card.appendChild(submit); host.appendChild(card); return;
  }

  var choices=document.createElement('div'); choices.className='choices';
  (item.choices||[]).forEach(function(c,idx){
    var btn=document.createElement('button'); btn.className='choice'; btn.textContent=c;
    btn.onclick=function(){
      state.seen[item.id]=(state.seen[item.id]||0)+1;
      if(item.type==='mc'){
        var correctIndex = ansIndexes()[0] || 0;
        Array.prototype.slice.call(choices.children).forEach(function(o,i){ o.disabled=true; if(i===correctIndex) o.classList.add('correct'); });
        if(idx!==correctIndex) btn.classList.add('wrong');
        showReview(idx===correctIndex);
      } else {
        btn.classList.toggle('picked');
        btn.style.borderColor = btn.classList.contains('picked')?'#7da3ff':'#2a2f58';
      }
    };
    choices.appendChild(btn);
  });
  card.appendChild(choices);

  if(item.type==='multi'){
    var submit=document.createElement('button'); submit.className='btn'; submit.textContent='Submit'; submit.style.marginTop='10px';
    submit.onclick=function(){
      var picks = Array.prototype.slice.call(choices.children).map(function(b,i){ return b.classList.contains('picked')?i:-1; }).filter(function(i){ return i>-1; });
      var ans = ansIndexes();
      var ok = picks.length && picks.length===ans.length && picks.every(function(i){ return ans.indexOf(i)>-1; });
      Array.prototype.slice.call(choices.children).forEach(function(o,i){
        o.disabled=true;
        if(ans.indexOf(i)>-1) o.classList.add('correct');
        if(picks.indexOf(i)>-1 && ans.indexOf(i)===-1) o.classList.add('wrong');
      });
      showReview(ok);
    };
    card.appendChild(submit);
  }

  host.appendChild(card);
}

/* ==== Quiz ==== */
var quizDeck=[], quizCorrect=0, quizTotal=0;
function startQuiz(){
  var filter = $('#quizDomain').value || 'all';
  var count = parseInt($('#quizCount').value,10) || 10;
  var pool = shuffle(ITEMS.filter(function(i){ return filter==='all' || (i.core+' · '+i.domain)===filter; }));
  quizDeck = pool.slice(0,count); quizCorrect=0; quizTotal=count; renderQuizNext();
}
function renderQuizNext(){
  var item = quizDeck.shift();
  if(!item){ $('#quizArea').innerHTML="<div class='center'><div>Score: <strong>"+quizCorrect+"/"+quizTotal+"</strong></div><div class='controls' style='margin-top:10px'><button class='btn' onclick='startQuiz()'>Play again</button></div></div>"; return; }
  renderItem('#quizArea', item, function(ok){ if(ok){ quizCorrect++; addXP(10); incStreak(); } else { addXP(-3); resetStreak(); } renderQuizNext(); }, false, {mode:'quiz'});
}

/* ==== Exam ==== */
function startExam(){
  var host=$('#examArea'); var minutes=90; var time=minutes*60;
  var pool=shuffle(ITEMS).slice(0, Math.min(90, ITEMS.length)); var correct=0, idx=0;
  host.innerHTML=''; var header=document.createElement('div'); header.className='row'; var timer=document.createElement('div'); timer.className='timer pill'; timer.textContent='90:00'; header.appendChild(timer); host.appendChild(header);
  var t=setInterval(function(){ time--; if(time<=0){ finish(); } var m=Math.floor(time/60), s=String(time%60).padStart?String(time%60).padStart(2,'0'):('0'+(time%60)).slice(-2); timer.textContent=m+":"+s; },1000);
  function finish(){ clearInterval(t); var pct=Math.round((correct/Math.max(1,pool.length))*100); var pass=pct>=75; host.innerHTML="<div class='center'><div>Exam Complete — Score: <strong>"+pct+"%</strong> "+(pass?"<span class='ok'>(PASS)</span>":"<span class='bad'>(FAIL)</span>")+"</div><div class='controls' style='margin-top:10px'><button class='btn' onclick='startExam()'>Retry</button></div></div>"; }
  function next(){ var item=pool[idx++]; if(!item){ finish(); return; } renderItem('#examArea', item, function(ok){ if(ok){ correct++; addXP(5);} else { addXP(-1);} next(); }, false, {mode:'exam'}); }
  next();
}

/* ==== Mode & Domains ==== */
function gotoMode(mode){
  ['learn','quiz','exam'].forEach(function(id){ $('#'+id).classList.toggle('hidden', id!==mode); });
}
function fillDomains(){
  var domains = [];
  ITEMS.forEach(function(i){ var key=i.core+' · '+i.domain; if(domains.indexOf(key)===-1) domains.push(key); });
  domains.sort();
  function put(el){ var html = "<option value='all'>All Domains</option>"+domains.map(function(d){ return "<option>"+d+"</option>"; }).join(''); el.innerHTML=html; }
  put($('#learnDomain')); put($('#quizDomain'));
  $('#teachToggle').checked = !!state.settings.teach;
}

function init(){ fillDomains(); updateHeader(); }
init();
</script>
</body>
</html>
