<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A+ Arcade — CompTIA A+ 220-1201/1202 Study Game</title>
<style>
  :root {
    --bg: #0f1220;
    --panel: #171a2b;
    --panel-2: #1e2240;
    --text: #e7e9f5;
    --muted: #a9add4;
    --accent: #8ab4ff;
    --accent-2: #7df9c9;
    --danger: #ff6b6b;
    --warn: #ffd166;
    --ok: #06d6a0;
  }
  * { box-sizing:border-box; }
  body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial; background:linear-gradient(180deg, #0d1020, #171a2b 45%, #0d1020); color:var(--text); }
  header { position:sticky; top:0; z-index:10; background:rgba(15,18,32,.9); backdrop-filter: blur(8px); border-bottom:1px solid #2a2f58; }
  .wrap { max-width:1100px; margin:0 auto; padding:16px; }
  h1 { margin:0; font-size:24px; letter-spacing:.4px; }
  .subtitle { color:var(--muted); font-size:13px; margin-top:6px; }
  .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; }
  .card { background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid #2a2f58; border-radius:16px; padding:14px; box-shadow: 0 6px 24px rgba(0,0,0,.25); }
  .card h3 { margin:4px 0 8px; font-size:16px; }
  .btn { display:inline-flex; align-items:center; gap:8px; background:linear-gradient(180deg,#263067,#1e264d); border:1px solid #33408c; padding:10px 14px; border-radius:12px; color:var(--text); text-decoration:none; cursor:pointer; font-weight:600; transition:.15s transform ease; }
  .btn:hover { transform: translateY(-1px); }
  .btn.secondary { background:#1a1d33; border-color:#2a2f58; color:#c9cdf5 }
  .btn.ghost { background:transparent; border-color:#2a2f58; color:#b9bdf0 }
  .controls { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
  .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid #2a2f58; color:#bfc3f7; background:#151936; }
  .kpi { display:flex; gap:10px; align-items:center; font-size:14px; color:#c7ccff }
  progress { width:100%; height:10px; -webkit-appearance:none; appearance:none; }
  progress::-webkit-progress-bar { background:#20264a; border-radius:999px; }
  progress::-webkit-progress-value { background: linear-gradient(90deg, var(--accent), var(--accent-2)); border-radius:999px; }
  .row { display:flex; gap:12px; align-items:center; }
  .row.wrap { flex-wrap:wrap }
  .spacer { flex:1; }
  .muted { color:var(--muted) }
  .bad { color:var(--danger) }
  .ok { color:var(--ok) }
  .warn { color:var(--warn) }
  .inset { padding:12px; border-radius:12px; background:#10142c; border:1px solid #222959; }
  .list { margin:8px 0 0; padding:0; list-style:none; }
  .list li { padding:8px 10px; border-bottom:1px dashed #27306a; }
  .list li:last-child { border-bottom:0 }
  .tag { font-size:11px; color:#c9cdf5; background:#111634; border:1px solid #2a2f58; padding:3px 8px; border-radius:999px; }
  .notice { background:#0f1c30; border:1px solid #2a2f58; padding:10px 12px; border-radius:12px; color:#b7c1ff; }
  .mode-tab { padding:8px 12px; border-radius:10px; border:1px solid #2a2f58; cursor:pointer; background:#14183a; color:#c9cdf5; }
  .mode-tab.active { background:linear-gradient(180deg,#25306a,#1a1f45); color:#fff }
  .question { font-size:16px; line-height:1.45; }
  .choices { display:grid; gap:8px; margin-top:12px; }
  .choice { padding:10px 12px; border-radius:12px; border:1px solid #2a2f58; cursor:pointer; background:#121735; }
  .choice.correct { border-color:#1fbf8f; box-shadow:inset 0 0 0 1px #1fbf8f; }
  .choice.wrong { border-color:#d34b4b; box-shadow:inset 0 0 0 1px #d34b4b; }
  .answer { margin-top:10px; font-size:14px; color:#cfd4ff; }
  .small { font-size:12px }
  .pairs { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  .dr { padding:8px 10px; border:1px dashed #3b468a; border-radius:10px; background:#121735; cursor:grab; }
  .drop { min-height:44px; padding:8px 10px; border:1px dashed #5a66b5; border-radius:10px; background:#0f152f; }
  .flex { display:flex; }
  .col { display:flex; flex-direction:column; }
  .center { display:grid; place-items:center; min-height:120px; }
  .hidden { display:none; }
  .xp { font-weight:700 }
  .badge { display:inline-flex; align-items:center; gap:6px; border:1px solid #2a2f58; background:#14183a; padding:6px 10px; border-radius:999px; }
  .ach { display:flex; gap:10px; align-items:center; padding:10px; border-radius:12px; border:1px solid #2a2f58; background:#10142c; }
  .ach.done { border-color:#1fbf8f; background:#0f1f20; }
  .ach-title { font-weight:700 }
  .timer { font-variant:tabular-nums; }
  .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  @media (max-width:700px){ .pairs { grid-template-columns:1fr; } }
  /* verdict banner for Learn mode */
  .verdict { margin-top:10px; padding:10px 12px; border-radius:12px; border:1px solid #2a2f58; background:#101a33; font-weight:700; }
  .verdict.ok { border-color:#1fbf8f; background:#0f1f20; }
  .verdict.bad { border-color:#d34b4b; background:#2a1420; }
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row wrap">
        <div>
          <h1>A+ Arcade</h1>
          <div class="subtitle">Gamified study for CompTIA A+ Core 1 (220-1201) & Core 2 (220-1202)</div>
        </div>
        <div class="spacer"></div>
        <div class="kpi"><span>LVL <span id="lvl">1</span></span> · <span class="xp"><span id="xp">0</span> XP</span> · <span>Streak <span id="streak">0</span></span></div>
      </div>
      <div class="wrap" style="padding-top:8px;">
        <div class="controls">
          <button class="mode-tab active" data-mode="home">Home</button>
          <button class="mode-tab" data-mode="learn">Learn (SRS)</button>
          <button class="mode-tab" data-mode="quiz">Arcade Quiz</button>
          <button class="mode-tab" data-mode="match">Match</button>
          <button class="mode-tab" data-mode="boss">Boss Battles</button>
          <button class="mode-tab" data-mode="exam">Exam Simulator</button>
          <button class="mode-tab" data-mode="objectives">Objectives</button>
          <button class="mode-tab" data-mode="profile">Profile</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap" id="app" style="padding-bottom:64px;">

    <!-- HOME -->
    <section id="home">
      <div class="grid">
        <div class="card">
          <h3>Quick Start</h3>
          <p class="muted">Pick a mode. Earn XP. Level up skills across every A+ objective. Your progress auto-saves (local only).</p>
          <div class="controls">
            <button class="btn" onclick="gotoMode('learn')">Start: Learn (SRS)</button>
            <button class="btn secondary" onclick="gotoMode('quiz')">10-Question Quiz</button>
            <button class="btn ghost" onclick="gotoMode('exam')">Full Exam Sim</button>
          </div>
          <div class="notice" style="margin-top:10px;">
            <strong>Heads-up:</strong> This build aligns to the latest 220-1201/1202 objectives. Content packs can be imported to expand the bank. Check <em>Objectives</em> for coverage.
          </div>
        </div>
        <div class="card">
          <h3>Coverage</h3>
          <div class="row">
            <div style="width:100%">
              <div class="row"><span class="pill">1201 · Core 1</span><span class="spacer"></span><span class="small muted">Mobile · Networking · Hardware · Virt/Cloud · H/W & Net Troubleshooting</span></div>
              <progress id="cov1201" value="0" max="100"></progress>
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <div style="width:100%">
              <div class="row"><span class="pill">1202 · Core 2</span><span class="spacer"></span><span class="small muted">OS · Security · Software Troubleshooting · Operational Procedures</span></div>
              <progress id="cov1202" value="0" max="100"></progress>
            </div>
          </div>
          <p class="small muted" style="margin-top:8px;">Coverage % = items studied in each core / total items available.</p>
        </div>
        <div class="card">
          <h3>Import / Export</h3>
          <p class="muted">Bring in new question packs (JSON) or export your progress.</p>
          <div class="controls">
            <label class="btn" for="fileIn">Import JSON</label>
            <input id="fileIn" class="sr-only" type="file" accept="application/json" />
            <button class="btn secondary" onclick="exportProgress()">Export Progress</button>
            <button class="btn ghost" onclick="resetProgress()">Reset</button>
          </div>
          <p class="small muted">Schema documented under <em>Profile → Data Schema</em>.</p>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <h3>Achievements</h3>
        <div id="achievements" class="grid"></div>
      </div>
    </section>

    <!-- LEARN (SRS) -->
    <section id="learn" class="hidden">
      <div class="row wrap">
        <div class="pill">Spaced Repetition (SM-2)</div>
        <div class="spacer"></div>
        <select id="learnDomain" class="btn ghost"></select>
        <button class="btn" onclick="startLearn()">Load Due Cards</button>
      </div>
      <div id="learnArea" class="card" style="margin-top:12px;">
        <div class="center muted">Select a domain and press <strong>Load Due Cards</strong>.</div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="hidden">
      <div class="row wrap">
        <div class="pill">Arcade Quiz</div>
        <div class="spacer"></div>
        <select id="quizDomain" class="btn ghost"></select>
        <select id="quizCount" class="btn ghost">
          <option value="10">10 Qs</option>
          <option value="20">20 Qs</option>
          <option value="30">30 Qs</option>
        </select>
        <button class="btn" onclick="startQuiz()">Play</button>
      </div>
      <div id="quizArea" class="card" style="margin-top:12px;">
        <div class="center muted">Choose domain & count, then press <strong>Play</strong>.</div>
      </div>
    </section>

    <!-- MATCH -->
    <section id="match" class="hidden">
      <div class="row wrap">
        <div class="pill">Matching</div>
        <div class="spacer"></div>
        <select id="matchSet" class="btn ghost"></select>
        <button class="btn" onclick="startMatch()">Start</button>
      </div>
      <div id="matchArea" class="card" style="margin-top:12px;">
        <div class="center muted">Pick a set and press <strong>Start</strong>.</div>
      </div>
    </section>

    <!-- BOSS BATTLES -->
    <section id="boss" class="hidden">
      <div class="row wrap">
        <div class="pill">Boss Battles</div>
        <div class="spacer"></div>
        <select id="bossDomain" class="btn ghost"></select>
        <button class="btn" onclick="startBoss()">Fight Boss</button>
      </div>
      <div id="bossArea" class="card" style="margin-top:12px;">
        <div class="center muted">Select a domain and press <strong>Fight Boss</strong>. 10 questions · 60s timer · 80% to win.</div>
      </div>
    </section>

    <!-- EXAM SIM -->
    <section id="exam" class="hidden">
      <div class="row wrap">
        <div class="pill">Exam Simulator</div>
        <div class="spacer"></div>
        <button class="btn" onclick="startExam()">Start Full Sim</button>
      </div>
      <div id="examArea" class="card" style="margin-top:12px;">
        <div class="center muted">90 minutes · up to 90 questions · mixed types. Scored against A+ passing thresholds.</div>
      </div>
    </section>

    <!-- OBJECTIVES -->
    <section id="objectives" class="hidden">
      <div class="card">
        <h3>Official Objective Map</h3>
        <p class="muted">Aligned to 220-1201 and 220-1202 official objectives. Use this as a checklist. (See <em>Profile → Sources</em> for official PDFs.)</p>
        <div id="objList" class="grid"></div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile" class="hidden">
      <div class="grid">
        <div class="card">
          <h3>Player</h3>
          <ul class="list">
            <li>Level: <strong id="pLevel">1</strong></li>
            <li>XP: <strong id="pXP">0</strong></li>
            <li>Streak: <strong id="pStreak">0</strong></li>
            <li>Boss Wins: <strong id="pBossWins">0</strong></li>
          </ul>
        </div>
        <div class="card">
          <h3>Data Schema</h3>
          <pre class="small muted" style="white-space:pre-wrap">
Item { id, core:"1201|1202", domain:"Networking|Hardware|...", sub:"", type:"mc|multi|type|match|pbq", prompt, choices:["A","B",...], answer:[indexes or strings], explain, why, tags:["ports","wifi"], srs:{ef, rep, ivl, due}}
MatchSet { id, core, name, pairs:[[left,right], ...] }
          </pre>
          <p class="small muted">Import JSON with { items:[Item,...], matchSets:[MatchSet,...] }.</p>
        </div>
        <div class="card">
          <h3>Sources</h3>
          <ul class="list">
            <li>CompTIA A+ 220-1201 Objectives (PDF)</li>
            <li>CompTIA A+ 220-1202 Objectives (PDF)</li>
            <li>Exam structure & scoring (public info)</li>
          </ul>
          <p class="small muted">This is an unofficial study tool. Always verify with the official objectives.</p>
        </div>
      </div>
    </section>

  </main>

<script>
/********************
 * Utility & Storage *
 ********************/
const $ = (q) => document.querySelector(q);
const $$ = (q) => Array.from(document.querySelectorAll(q));
const rnd = (n) => Math.floor(Math.random()*n);
const shuffle = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
const uid = () => Math.random().toString(36).slice(2,9);

const SAVE_KEY = 'aplus_arcade_v120x';
let state = JSON.parse(localStorage.getItem(SAVE_KEY) || 'null') || {
  xp: 0, level:1, streak:0, bossWins:0,
  seen: {}, // id -> attempts
  correct: {}, // id -> correct count
  srs: {}, // id -> {ef,rep,ivl,due}
  // achievements flags
  ach: { streak10:false, ports50:false, osPerfect:false, examPass:false }
};
function save(){ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); updateHeader(); renderAchievements(); }
function resetProgress(){ if(confirm('Reset all progress?')){ localStorage.removeItem(SAVE_KEY); state = {xp:0,level:1,streak:0,bossWins:0,seen:{},correct:{},srs:{},ach:{streak10:false,ports50:false,osPerfect:false,examPass:false}}; save(); alert('Progress cleared.'); } }
function exportProgress(){ const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'aplus-arcade-progress.json'; a.click(); URL.revokeObjectURL(url); }

/****************
 * Content Data *
 ****************/
// NOTE: This starter bank is intentionally compact (≈120 items) to keep the file size reasonable.
// You can IMPORT larger packs from the Home → Import button.

const ITEMS = [];
const MATCH_SETS = [];
const OBJ = [
  { core:'1201', domain:'Mobile Devices', bullets:[
    'Install & configure laptop hardware/components',
    'Mobile device accessories & ports',
    'Mobile device synchronization methods']},
  { core:'1201', domain:'Networking', bullets:[
    'SOHO network types & features', 'Common ports & protocols', 'Wireless standards & encryption', 'Network devices & tools']},
  { core:'1201', domain:'Hardware', bullets:[
    'Cables & connectors', 'Power supplies & motherboards', 'RAM & storage', 'Peripherals & printers']},
  { core:'1201', domain:'Virtualization & Cloud', bullets:[
    'Client-side virtualization', 'Cloud models & services', 'Thin/Thick provisioning basics']},
  { core:'1201', domain:'Hardware/Network Troubleshooting', bullets:[
    'Troubleshooting methodology', 'Common hardware failures', 'Network troubleshooting tools & commands']},
  { core:'1202', domain:'Operating Systems', bullets:[
    'Windows editions, features, install/upgrade', 'macOS & Linux basics', 'Command-line tools', 'System utilities']},
  { core:'1202', domain:'Security', bullets:[
    'Threats & vulnerabilities', 'Secure protocols', 'Authentication & permissions', 'Wireless security & hardening']},
  { core:'1202', domain:'Software Troubleshooting', bullets:[
    'OS & application errors', 'Mobile OS issues', 'Malware symptoms & removal']},
  { core:'1202', domain:'Operational Procedures', bullets:[
    'Safety & environmental impacts', 'Communication & professionalism', 'Change management & documentation', 'SLA, licensing, and incident response basics']},
];

// === Helper to add MC items quickly
function addMC(core, domain, prompt, choices, answerIndex, explain, tags=[]) {
  ITEMS.push({ id: uid(), core, domain, type:'mc', prompt, choices, answer:[answerIndex], explain, tags });
}
// === Helper to add multi-answer
function addMulti(core, domain, prompt, choices, answerIndexes, explain, tags=[]) {
  ITEMS.push({ id: uid(), core, domain, type:'multi', prompt, choices, answer:answerIndexes, explain, tags });
}
// === Type-in items
function addType(core, domain, prompt, answerStrings, explain, tags=[]) {
  ITEMS.push({ id: uid(), core, domain, type:'type', prompt, answer:answerStrings.map(s=>s.toLowerCase()), explain, tags });
}
// === Matching set
function addMatch(core, name, pairs){ MATCH_SETS.push({ id: uid(), core, name, pairs }); }

// --- Seed content (concise but broad)
// Ports & Protocols
addMatch('1201','Ports ↔ Protocols', [
  ['20/21','FTP'],['22','SSH'],['23','Telnet'],['25','SMTP'],['53','DNS'],['67/68','DHCP'],['80','HTTP'],['110','POP3'],['143','IMAP'],['123','NTP'],['161/162','SNMP'],['389','LDAP'],['443','HTTPS'],['445','SMB'],['548','AFP'],['3389','RDP']
]);
addMC('1201','Networking','Which protocol and port are used for secure web traffic?', ['HTTP on 80','HTTPS on 443','TLS on 995','SSH on 22'], 1, 'HTTPS typically uses TCP 443.', ['ports']);
addType('1201','Networking','Default TCP port for SMB file sharing on modern Windows?', ['445'], 'SMB over TCP uses 445.', ['ports']);
addType('1202','Security','Write the secure alternative to Telnet.', ['ssh'], 'SSH replaces Telnet for encrypted remote terminal sessions.', ['ports']);

// Wireless standards
addMC('1201','Networking','802.11ac operates primarily in which band?', ['2.4 GHz','5 GHz','900 MHz','Both 2.4 and 5 GHz'], 1, '802.11ac is 5 GHz only.', ['wifi']);
addMC('1201','Networking','Which 802.11 standard introduced OFDMA and 1024-QAM?', ['802.11n','802.11ac','802.11ax','802.11g'], 2, '802.11ax (Wi-Fi 6) adds OFDMA and 1024-QAM.', ['wifi']);
addMC('1201','Networking','Best channel choice to avoid overlap on 2.4 GHz in NA?', ['1, 6, 11','2, 7, 12','3, 6, 9','4, 8, 13'], 0, 'Use non-overlapping channels 1, 6, 11.', ['wifi']);

// Cabling & connectors
addMatch('1201','Cable ↔ Max Distance', [
  ['Cat5e 1000BASE-T','100 m'],['Cat6 10GBASE-T','55 m'],['Cat6a 10GBASE-T','100 m'],['Multimode fiber (OM3)','300 m @10G'],['Single-mode fiber','10+ km']
]);
addMC('1201','Hardware','Which connector provides digital audio+video and supports HDCP?', ['VGA','DVI-D','HDMI','DisplayPort'], 2, 'HDMI supports digital A/V and HDCP. DP also, but common answer is HDMI.');
addMC('1201','Hardware','Which printer uses an imaging drum and fuser?', ['Laser','Inkjet','Thermal','Impact'], 0, 'Laser printers use toner, drum, transfer, and fuser stages.', ['printer']);

// RAM & storage
addMC('1201','Hardware','DDR4 DIMMs have how many pins (desktop)?', ['184','200','240','288'], 3, 'DDR4 desktop DIMMs use 288 pins.');
addMC('1201','Hardware','Which RAID provides striping with parity (single-disk fault tolerance)?', ['RAID 0','RAID 1','RAID 5','RAID 10'], 2, 'RAID 5 = striping with distributed parity.', ['raid']);
addMC('1201','Hardware','M.2 NVMe typically uses which bus?', ['SATA','USB','PCIe','Thunderbolt'], 2, 'NVMe uses PCIe lanes for high throughput and low latency.');

// Virtualization & Cloud
addMC('1201','Virtualization & Cloud','A user runs Windows on a Mac with Parallels. This is:', ['Type 1 hypervisor','Type 2 hypervisor','Bare-metal virtualization','Containerization'], 1, 'Parallels/VMware Workstation are type 2 (hosted).');
addMC('1201','Virtualization & Cloud','IaaS provides:', ['Hosted apps only','Virtualized hardware resources','Developer platforms only','Security services only'], 1, 'IaaS = compute, storage, network building blocks.');

// Troubleshooting methodology
addMC('1201','Hardware/Network Troubleshooting','First step of the troubleshooting process?', ['Identify the problem','Establish a theory','Test the theory','Document findings'], 0, 'CompTIA methodology starts with identifying the problem.');
addMC('1201','Hardware/Network Troubleshooting','User reports intermittent Wi-Fi. First simple fix?', ['Replace NIC','Change SSID','Move closer / reduce interference','Reimage OS'], 2, 'Eliminate interference/distance before invasive steps.', ['wifi']);

// OS fundamentals (Windows)
addMC('1202','Operating Systems','Which edition supports joining Active Directory in Windows 10?', ['Home','Pro','S','Education'], 1, 'Windows 10/11 Pro and above can join AD.');
addType('1202','Operating Systems','Command to check and repair Windows file system on next reboot?', ['chkdsk /f'], 'chkdsk with /f schedules repairs.');
addType('1202','Operating Systems','PowerShell package manager command prefix (v5+)?', ['install-package','find-package','get-package'], 'OneGet/PackageManagement cmdlets include Find-Package, Install-Package, etc.');
addMC('1202','Operating Systems','Where do you manage Windows services?', ['Device Manager','Services.msc','Control Panel > Programs','Task Scheduler'], 1, 'Services MMC or the Services snap-in.');

// macOS & Linux
addType('1202','Operating Systems','macOS disk utility for APFS/HFS+ volumes?', ['disk utility','diskutil'], 'Disk Utility (GUI) or diskutil (CLI).');
addType('1202','Operating Systems','Linux command to show IP configuration (newer distros)?', ['ip addr','ip a'], 'ip addr replaces ifconfig on many systems.');
addType('1202','Operating Systems','Linux: follow live log output for syslog file?', ['tail -f /var/log/syslog'], 'tail -f streams appended lines.');

// Security basics
addMC('1202','Security','Best practice for securing SOHO wireless?', ['WEP + hidden SSID','WPA2/WPA3-Personal + long passphrase','MAC filtering only','Open network'], 1, 'Use WPA2/WPA3 with strong passphrase; avoid WEP/open.', ['wifi']);
addMC('1202','Security','What does principle of least privilege enforce?', ['Admin rights to all','Deny by default','Users get only necessary permissions','Full access to expedite support'], 2, 'Grant minimum access required to perform tasks.');
addMC('1202','Security','Which is a social engineering attack?', ['ARP poisoning','Spear phishing','SQL injection','DDoS'], 1, 'Spear phishing targets specific individuals with crafted messages.');
addMC('1202','Security','Which tool removes persistent malware by booting a minimal OS?', ['Windows Defender Offline','System Restore','MSCONFIG','DISM'], 0, 'Defender Offline scans outside the main OS.');

// Software troubleshooting
addMC('1202','Software Troubleshooting','PC reboots randomly after installing a new GPU. Likely cause?', ['Bad PSU sizing','Too much RAM','Loose SATA cable','Wrong keyboard layout'], 0, 'Inadequate PSU wattage can cause reboots under load.', ['psu']);
addMC('1202','Software Troubleshooting','Browser has many pop-ups and redirects. First response?', ['Disable DNS','Run anti-malware scan','Reinstall OS','Replace RAM'], 1, 'Scan with reputable anti-malware, then remediate.');

// Operational procedures
addMC('1202','Operational Procedures','Proper ESD protection while working on a PC?', ['Touch the case occasionally','Use an ESD strap & mat','Wear rubber gloves','Stand on carpet'], 1, 'Use wrist strap connected to ground and an ESD mat.');
addMC('1202','Operational Procedures','Which framework is most relevant for change management?', ['ITIL','PCI DSS','HIPAA','GDPR'], 0, 'ITIL includes structured change management practices.');
addMC('1202','Operational Procedures','Best first response to a user report of PII leakage?', ['Erase evidence','Notify media','Follow incident response plan','Ignore until confirmed'], 2, 'Follow the IR plan: identify, contain, etc.');

// More quick hits
addType('1201','Hardware','What voltage does a SATA power connector provide besides 5V? (enter one of them)', ['3.3','12'], 'SATA power supplies 3.3V, 5V, and 12V.');
addType('1201','Hardware','UEFI replacement for BIOS setting files often named what extension for updates?', ['.cap'], '.CAP is common for UEFI capsule updates.');
addMC('1201','Hardware','Which connector for CPU power on modern boards?', ['Molex','ATX12V 4/8-pin','PCIe 6-pin','SATA power'], 1, 'CPU EPS12V 4/8-pin supplies CPU power.');
addMC('1201','Networking','Which command displays the ARP table in Windows?', ['arp -a','ipconfig /all','netstat -an','nslookup'], 0, 'arp -a shows ARP cache.');
addType('1202','Operating Systems','Windows tool to edit startup apps (modern builds)?', ['task manager'], 'Task Manager Startup tab.');
addMC('1202','Security','You suspect a phishing email. Best first action?', ['Click link to verify','Report per policy','Forward to coworkers','Delete silently'], 1, 'Report using the organization’s process.');
addMC('1202','Operational Procedures','SDS stands for:', ['System Data Sheet','Safety Data Sheet','Secure Data Standard','Software Distribution Set'], 1, 'SDS: Safety Data Sheet.');

// Small PBQ-style (multi-select)
addMulti('1201','Hardware','Select all connectors primarily for display output.', ['HDMI','DisplayPort','RJ-45','DVI-D'], [0,1,3], 'HDMI, DP, and DVI are video outputs; RJ-45 is networking.');
addMulti('1201','Networking','Select valid IPv6 features.', ['128-bit addresses','NAT required','No ARP (uses NDP)','Built-in IPSec'], [0,2,3], 'IPv6 uses NDP, has 128-bit addresses, and mandates IPSec support.');
addMulti('1202','Security','Choose strong authentication factors.', ['Password','Smart card','Fingerprint','Mother’s maiden name'], [1,2], 'Something you have (smart card) and something you are (biometrics).');

// Matching: Windows tools
addMatch('1202','Windows Tools', [
  ['msconfig','Manage boot options/services'],
  ['regedit','Edit the registry'],
  ['sfc /scannow','Verify system files'],
  ['dism /restorehealth','Repair component store'],
  ['eventvwr','View logs']
]);

// Add a few dozen more quick MC to broaden coverage
const quickMC = [
  ['1201','Networking','Cable with 4 twisted pairs and RJ-45?', ['UTP','Coax','STP','Fiber'], 0, 'UTP commonly terminates with RJ-45 for Ethernet.'],
  ['1201','Networking','Device that separates collision domains?', ['Hub','Switch','Repeater','Bridge'], 1, 'Switches create separate collision domains per port.'],
  ['1201','Hardware','Most common 3D printer filament for beginners?', ['ABS','PLA','PETG','Nylon'], 1, 'PLA prints easily at lower temps.'],
  ['1201','Hardware','Which slot is typical for modern GPUs?', ['PCI','AGP','PCIe x16','PCIe x1'], 2, 'GPUs use PCIe x16.'],
  ['1201','Hardware','What does POST stand for?', ['Power-On Self Test','Primary OS Startup','Peripheral Output System Test','Power Output & System Test'], 0, 'POST checks basic hardware at boot.'],
  ['1202','Operating Systems','Windows feature to create a previous system state snapshot?', ['System Restore','BitLocker','ReadyBoost','Hyper-V'], 0, 'System Restore rolls back system files and settings.'],
  ['1202','Security','What is shoulder surfing?', ['Looking over someone’s shoulder for info','Malware on the shoulder port','Weak shoulder password','Sports injury'], 0, 'Visual eavesdropping.'],
  ['1202','Software Troubleshooting','Blue screen right after driver update; best step?', ['Rollback driver','Replace PSU','Clear browser cache','Run defrag'], 0, 'Use Device Manager to roll back the driver.'],
  ['1202','Operational Procedures','What is the last step in the troubleshooting methodology?', ['Document findings','Test theory','Verify full functionality','Establish a plan'], 0, 'Always document.'],
];
quickMC.forEach(([core,domain,prompt,choices,ans,ex])=>addMC(core,domain,prompt,choices,ans,ex));

/*****************
 * Objectives UI *
 *****************/
function renderObjectives(){
  const wrap = $('#objList');
  wrap.innerHTML = '';
  OBJ.forEach(o=>{
    const totalDomain = ITEMS.filter(i=>i.domain===o.domain).length;
    const learned = ITEMS.filter(i=>i.domain===o.domain && state.seen[i.id]).length;
    const pct = totalDomain? Math.round((learned/totalDomain)*100): 0;
    const div = document.createElement('div');
    div.className = 'inset';
    div.innerHTML = `<div class="row"><div><strong>${o.core} · ${o.domain}</strong></div><div class="spacer"></div><div>${pct}%</div></div>
    <ul class="list">${o.bullets.map(b=>`<li>${b}</li>`).join('')}</ul>`;
    wrap.appendChild(div);
  });
  updateCoverageBars();
}

function updateCoverageBars(){
  const c1 = ITEMS.filter(i=>i.core==='1201').length;
  const c2 = ITEMS.filter(i=>i.core==='1202').length;
  const s1 = ITEMS.filter(i=>i.core==='1201' && state.seen[i.id]).length;
  const s2 = ITEMS.filter(i=>i.core==='1202' && state.seen[i.id]).length;
  $('#cov1201').value = c1? Math.round((s1/c1)*100):0;
  $('#cov1202').value = c2? Math.round((s2/c2)*100):0;
}

/****************
 * Achievements *
 ****************/
const ACH = [
  { key:'streak10', title:'Hot Streak', desc:'Answer 10 in a row correctly.' },
  { key:'ports50', title:'Ports Master', desc:'Score 90%+ on Ports ↔ Protocols in under 60s.' },
  { key:'osPerfect', title:'OS Whisperer', desc:'Perfect 10/10 in a Core 2 Boss Battle.' },
  { key:'examPass', title:'Exam Ready', desc:'Pass the full Exam Simulator at or above cut scores.' },
];
function renderAchievements(){
  const host = $('#achievements'); host.innerHTML = '';
  ACH.forEach(a=>{
    const card = document.createElement('div');
    card.className = 'ach ' + (state.ach[a.key] ? 'done' : '');
    card.innerHTML = `<div class="badge">🏆</div><div><div class="ach-title">${a.title}</div><div class="muted small">${a.desc}</div></div>`;
    host.appendChild(card);
  });
}

/*************
 * XP & LVLs *
 *************/
function addXP(n){
  state.xp += n; if(state.xp < 0) state.xp = 0; const newLevel = Math.floor(state.xp/200)+1; if(newLevel>state.level) toast(`Level up! → LVL ${newLevel}`);
  state.level = newLevel; save();
}
function incStreak(){ state.streak++; if(state.streak===10 && !state.ach.streak10){ state.ach.streak10=true; toast('🏆 Achievement: Hot Streak'); } save(); }
function resetStreak(){ state.streak=0; save(); }

/*****************
 * Toast helper  *
 *****************/
let toastTimer=null; function toast(msg){
  clearTimeout(toastTimer);
  let t = $('#toast'); if(!t){ t=document.createElement('div'); t.id='toast'; t.style.position='fixed'; t.style.bottom='20px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='#0b122a'; t.style.border='1px solid #2a2f58'; t.style.borderRadius='12px'; t.style.padding='10px 14px'; t.style.zIndex='99'; t.style.boxShadow='0 10px 30px rgba(0,0,0,.35)'; document.body.appendChild(t);} t.textContent=msg; t.style.opacity='1'; toastTimer=setTimeout(()=>{ t.style.opacity='0'; }, 2000);
}

/***********************
 * Mode switching tabs *
 ***********************/
function gotoMode(mode){
  $$('.mode-tab').forEach(b=>b.classList.toggle('active', b.dataset.mode===mode));
  ['home','learn','quiz','match','boss','exam','objectives','profile']
    .forEach(id=>$('#'+id).classList.toggle('hidden', id!==mode));
  if(mode==='objectives') renderObjectives();
  if(mode==='profile') updateProfile();
}

/*******************
 * Dropdown fills  *
 *******************/
function fillDomains(){
  const domains = [...new Set(ITEMS.map(i=>`${i.core} · ${i.domain}`))].sort();
  const sel = (el) => { el.innerHTML = `<option value="all">All Domains</option>` + domains.map(d=>`<option>${d}</option>`).join(''); };
  sel($('#learnDomain')); sel($('#quizDomain')); sel($('#bossDomain'));
  // Match sets
  $('#matchSet').innerHTML = MATCH_SETS.map((m)=>`<option value="${m.id}">${m.core} · ${m.name}</option>`).join('');
}

/* ============================
   WHY examples for Learn mode
   ============================ */
const WHY_BY_DOMAIN = {
  'Networking': 'Example: choosing the wrong port or protocol can block apps—e.g., opening 80 instead of 443 breaks secure sites.',
  'Hardware': 'Example: an underpowered PSU can cause random reboots when the GPU is under load.',
  'Operating Systems': 'Example: using Services.msc to restart a stuck service avoids rebooting a production PC.',
  'Security': 'Example: weak Wi-Fi security (WEP, short passphrases) lets attackers join your network quickly.',
  'Software Troubleshooting': 'Example: rolling back a faulty driver can instantly resolve a new BSOD.',
  'Operational Procedures': 'Example: change control prevents unplanned outages during business hours.',
  'Virtualization & Cloud': 'Example: picking IaaS when you need OS control avoids PaaS/runtime lock-in.',
  'Hardware/Network Troubleshooting': 'Example: following the CompTIA methodology avoids replacing good parts and wasting budget.',
  'Mobile Devices': 'Example: correct sync/MDM settings prevent data loss and protect corporate email.'
};
const WHY_BY_TAG = {
  ports: 'Example: opening the wrong port on a firewall leaves the service unreachable (e.g., RDP uses 3389).',
  wifi: 'Example: picking channels 1/6/11 on 2.4 GHz minimizes interference and keeps throughput stable.',
  raid: 'Example: RAID 5 parity tolerates one disk failure; a misconfig can cause data loss and downtime.',
  psu: 'Example: an undersized PSU leads to crashes under load.',
  printer: 'Example: understanding fuser/drum helps diagnose streaks and ghosting fast.'
};
function whyFor(item){
  if(item.why) return item.why;
  if(item.tags && item.tags.length){
    for(const t of item.tags){ if(WHY_BY_TAG[t]) return WHY_BY_TAG[t]; }
  }
  return WHY_BY_DOMAIN[item.domain] || 'On the job, this prevents outages, speeds troubleshooting, and improves security.';
}

/****************
 * Learn (SM-2) *
 ****************/
function sm2(item, quality){
  // Initialize if missing
  if(!state.srs[item.id]) state.srs[item.id] = { ef:2.5, rep:0, ivl:0, due: Date.now() };
  let {ef,rep,ivl} = state.srs[item.id];
  if(quality < 3){ rep = 0; ivl = 1; } else {
    if(rep === 0) ivl = 1; else if(rep === 1) ivl = 6; else ivl = Math.round(ivl * ef);
    rep += 1; ef = ef + (0.1 - (5-quality)*(0.08 + (5-quality)*0.02)); if(ef<1.3) ef=1.3;
  }
  const jitter = 0.1 + Math.random()*0.15; // add a bit of natural spacing
  const next = Date.now() + ivl*24*60*60*1000 * jitter;
  state.srs[item.id] = {ef,rep,ivl,due:next}; save();
}

let learnQueue = [];
function startLearn(){
  const filter = $('#learnDomain').value; const now = Date.now();
  learnQueue = ITEMS.filter(i=> (filter==='all' || `${i.core} · ${i.domain}`===filter) && (state.srs[i.id]?.due||0) <= now ).slice(0,30);
  if(learnQueue.length===0){ $('#learnArea').innerHTML = '<div class="center muted">No cards due. Try <em>Arcade Quiz</em> or switch domain.</div>'; return; }
  nextLearnCard();
}
function nextLearnCard(){
  const item = learnQueue.shift();
  if(!item){
    $('#learnArea').innerHTML='<div class="center ok">Nice! No more due cards.</div>';
    return;
  }
  renderItem('#learnArea', item, (correct,quality=correct?5:2)=>{
    recordResult(item, correct);
    sm2(item, quality);
    nextLearnCard();
  }, false, {mode:'learn'});
}

/********************
 * Render Question   *
 ********************/
// --- Replace your entire renderItem(...) with this version ---
function renderItem(selector, item, onDone, compact=false, opts={}) {
  const host = document.querySelector(selector); if(!host) return; host.innerHTML = '';

  const card = document.createElement('div'); card.className='inset';
  const meta = `<div class='row small muted'>
    <span class='pill'>${item.core||''}</span>
    <span class='pill'>${item.domain||''}</span>
    <span class='spacer'></span>
    <span class='pill'>${(item.type||'mc').toUpperCase()}</span>
  </div>`;
  const q = document.createElement('div'); q.className='question';
  q.innerHTML = meta + `<div style='margin-top:6px;'>${item.prompt||''}</div>`;
  card.appendChild(q);

  const answerDiv = document.createElement('div'); answerDiv.className='answer hidden';
  let answered=false;

  function verdictBlock(correct){
    // In Learn mode we ALWAYS show verdict + explanation + why
    if(opts.mode==='learn'){
      const explainHTML = item.explain ? `<div class='small' style='margin-top:6px;'>${item.explain}</div>` : '';
      const whyHTML = `<div style='margin-top:8px;'><strong>Why it matters:</strong> ${whyFor(item)}</div>`;
      answerDiv.innerHTML =
        `<div class="verdict ${correct?'ok':'bad'}">${correct?'✅ Correct!':'❌ Incorrect'}</div>` +
        explainHTML + whyHTML;
    } else {
      // Other modes: explanation only (if present)
      answerDiv.innerHTML = item.explain ? `<div>${item.explain}</div>` : '';
    }
  }

  function showNextOrFinish(correct){
    answerDiv.classList.remove('hidden');
    if(opts.mode==='learn'){
      const nextBtn = document.createElement('button');
      nextBtn.className='btn';
      nextBtn.textContent='Next';
      nextBtn.style.marginTop='10px';
      nextBtn.onclick=()=>{ if(answered) return; answered=true; onDone && onDone(correct, correct?5:2); };
      answerDiv.appendChild(nextBtn);
    } else {
      if(answered) return; answered=true; onDone && onDone(correct, correct?5:2);
    }
  }

  if(item.type==='mc' || item.type==='multi'){
    const choices = document.createElement('div'); choices.className='choices';
    (item.choices||[]).forEach((c,idx)=>{
      const btn=document.createElement('button'); btn.className='choice'; btn.textContent=c;
      btn.onclick=()=>{
        state.seen[item.id]=(state.seen[item.id]||0)+1;
        if(item.type==='mc'){
          const correctIndex = (item.answer||[0])[0];
          Array.from(choices.children).forEach((o,i)=>{ o.disabled=true; if(i===correctIndex) o.classList.add('correct'); });
          if(idx!==correctIndex) btn.classList.add('wrong');
          const ok = idx===correctIndex;
          verdictBlock(ok);
          card.appendChild(answerDiv);
          showNextOrFinish(ok);
        } else {
          // multi-select: toggle; submit below
          btn.classList.toggle('picked');
          btn.style.borderColor = btn.classList.contains('picked')?'#7da3ff':'#2a2f58';
        }
      };
      choices.appendChild(btn);
    });
    card.appendChild(choices);

    if(item.type==='multi'){
      const submit = document.createElement('button'); submit.className='btn'; submit.textContent='Submit'; submit.style.marginTop='10px';
      submit.onclick=()=>{
        const picks = Array.from(choices.children).map((b,i)=> b.classList.contains('picked')?i:-1).filter(i=>i>-1);
        const ans = (item.answer||[]);
        const ok = picks.length && picks.length===ans.length && picks.every(i=> ans.includes(i));
        Array.from(choices.children).forEach((o,i)=>{
          if(ans.includes(i)) o.classList.add('correct');
          if(picks.includes(i) && !ans.includes(i)) o.classList.add('wrong');
          o.disabled=true;
        });
        verdictBlock(ok);
        card.appendChild(answerDiv);
        showNextOrFinish(ok);
      };
      card.appendChild(submit);
    }
  } else if(item.type==='type'){
    const inp=document.createElement('input'); inp.type='text'; inp.placeholder='Type your answer';
    inp.style.width='100%'; inp.style.padding='10px'; inp.style.borderRadius='10px';
    inp.style.border='1px solid #2a2f58'; inp.style.background='#0f152f'; inp.style.color='var(--text)';
    const submit=document.createElement('button'); submit.className='btn'; submit.textContent='Check'; submit.style.marginTop='10px';
    submit.onclick=()=>{
      state.seen[item.id]=(state.seen[item.id]||0)+1;
      const v=(inp.value||'').trim().toLowerCase();
      const ok = (item.answer||[]).some(a=> String(a).toLowerCase()===v);
      verdictBlock(ok);
      const answers = `<div class='small muted' style='margin-top:6px;'>Answer(s): <strong>${(item.answer||[]).join(', ')}</strong></div>`;
      answerDiv.innerHTML += answers;
      inp.style.borderColor = ok?'#1fbf8f':'#d34b4b';
      card.appendChild(answerDiv);
      showNextOrFinish(ok);
    };
    card.append(inp); card.append(submit);
  }

  host.appendChild(card);
}


/*******************
 * Import JSON Pack *
 *******************/
$('#fileIn').addEventListener('change', async (e)=>{
  const file = e.target.files[0]; if(!file) return; const txt = await file.text();
  try{
    const data = JSON.parse(txt);
    if(Array.isArray(data.items)) data.items.forEach(i=> ITEMS.push({...i, id: i.id||uid()}));
    if(Array.isArray(data.matchSets)) data.matchSets.forEach(m=> MATCH_SETS.push({...m, id: m.id||uid()}));
    toast('Imported successfully.');
    fillDomains(); renderObjectives();
  } catch(err){
    alert('Invalid JSON pack.');
  }
});

/***********
 * Profile  *
 ***********/
function updateProfile(){ $('#pLevel').textContent = state.level; $('#pXP').textContent = state.xp; $('#pStreak').textContent = state.streak; $('#pBossWins').textContent = state.bossWins; }
function updateHeader(){ $('#lvl').textContent=state.level; $('#xp').textContent=state.xp; $('#streak').textContent=state.streak; }

/**********************
 * Re-wire tab clicks *
 **********************/
function init(){
  $$('.mode-tab').forEach(btn=>btn.addEventListener('click', ()=>gotoMode(btn.dataset.mode)));
  fillDomains(); renderObjectives(); renderAchievements(); updateHeader();
}
init();
</script>
</body>
</html>
